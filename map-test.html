<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walkable Areas Grid Test</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h1 {
            margin-bottom: 24px;
            color: #1f2937;
        }

        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        input, select, button {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        button {
            background: #4f46e5;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        button:hover {
            background: #4338ca;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 600px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: #f9fafb;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1000;
        }

        .grid-cell {
            position: absolute;
            border: 1px solid rgba(79, 70, 229, 0.3);
            background: rgba(79, 70, 229, 0.1);
            transition: all 0.2s;
            cursor: pointer;
            pointer-events: auto;
        }

        .grid-cell.walkable {
            background: rgba(34, 197, 94, 0.3);
            border-color: rgba(34, 197, 94, 0.6);
        }

        .grid-cell.non-walkable {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.6);
        }

        .grid-cell.unknown {
            background: rgba(156, 163, 175, 0.2);
            border-color: rgba(156, 163, 175, 0.4);
        }

        .grid-cell:hover {
            opacity: 0.8;
            transform: scale(1.02);
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(0,0,0,0.2);
        }

        .info-panel {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }

        .info-panel h3 {
            margin-bottom: 8px;
            color: #1e293b;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .stat {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
        }

        .stat-label {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        .instructions {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .instructions h3 {
            color: #92400e;
            margin-bottom: 8px;
        }

        .instructions ul {
            color: #92400e;
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 4px;
        }

        .keyboard-shortcuts {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
            font-size: 12px;
        }

        .keyboard-shortcuts strong {
            color: #1e40af;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .map-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Walkable Areas Grid Test</h1>
        
        <div class="instructions">
            <h3>üìã How to Use This Test</h3>
            <ul>
                <li>Enter your coordinates or click "üìç Use My Location"</li>
                <li>Click "üó∫Ô∏è Load Map" to visualize your area</li>
                <li>Click "‚¨ú Generate Grid" to create the test grid</li>
                <li>Click grid cells to cycle through: Unknown ‚Üí Walkable ‚Üí Non-walkable</li>
                <li>Observe how coverage percentage changes as you classify areas</li>
            </ul>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="latitude">Your Latitude:</label>
                <input type="number" id="latitude" step="0.000001" placeholder="e.g., 40.7128" />
            </div>
            
            <div class="control-group">
                <label for="longitude">Your Longitude:</label>
                <input type="number" id="longitude" step="0.000001" placeholder="e.g., -74.0060" />
            </div>
            
            <div class="control-group">
                <label for="grid-size">Grid Size:</label>
                <select id="grid-size">
                    <option value="10">10x10</option>
                    <option value="15" selected>15x15</option>
                    <option value="20">20x20</option>
                    <option value="25">25x25</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="radius">Radius (meters):</label>
                <input type="number" id="radius" value="500" min="100" max="2000" step="50" />
            </div>
            
            <button onclick="getCurrentLocation()">üìç Use My Location</button>
            <button onclick="showLocationHelp()">‚ùì Need Coordinates?</button>
            <button onclick="loadMap()">üó∫Ô∏è Load Map</button>
            <button onclick="generateGrid()">‚¨ú Generate Grid</button>
            <button onclick="clearGrid()">üßπ Clear Grid</button>
        </div>

        <div class="map-container">
            <div id="map">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #6b7280; font-size: 18px; text-align: center; flex-direction: column; gap: 16px;">
                    <div style="font-size: 48px;">üìç</div>
                    <div>Enter coordinates and click "Load Map" to begin</div>
                    <div style="font-size: 14px; color: #9ca3af;">This simulates how your dog walking app would analyze walkable areas</div>
                </div>
            </div>
            <div class="grid-overlay" id="grid-overlay"></div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(34, 197, 94, 0.3); border-color: rgba(34, 197, 94, 0.6);"></div>
                <span>Walkable (roads, sidewalks, parks)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(239, 68, 68, 0.3); border-color: rgba(239, 68, 68, 0.6);"></div>
                <span>Non-walkable (private property, buildings)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(156, 163, 175, 0.2); border-color: rgba(156, 163, 175, 0.4);"></div>
                <span>Unknown/Unclassified</span>
            </div>
        </div>

        <div class="info-panel">
            <h3>üìä Grid Analysis</h3>
            <p>Click on grid cells to classify areas. This simulates how the app would analyze walkable vs non-walkable areas in your residential neighborhood.</p>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="walkable-count">0</div>
                    <div class="stat-label">Walkable Cells</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="non-walkable-count">0</div>
                    <div class="stat-label">Non-walkable Cells</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="unknown-count">0</div>
                    <div class="stat-label">Unknown Cells</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="coverage-percent">0%</div>
                    <div class="stat-label">Area Coverage</div>
                </div>
            </div>

            <div class="keyboard-shortcuts">
                <strong>Keyboard Shortcuts:</strong> Press <strong>1</strong> then click = Walkable | <strong>2</strong> then click = Non-walkable | <strong>3</strong> then click = Unknown | <strong>C</strong> = Clear grid | <strong>G</strong> = Generate grid
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map = null;
        let gridCells = [];
        let currentState = 'walkable'; // Current classification mode

        // Sample coordinates (New York City) - user will replace with their location
        const defaultCoords = { lat: 40.7128, lng: -74.0060 };

        function getCurrentLocation() {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'üì° Getting location...';
            button.disabled = true;

            console.log('Attempting to get location...');

            if (!navigator.geolocation) {
                alert('Geolocation is not supported by this browser.');
                button.textContent = originalText;
                button.disabled = false;
                return;
            }

            // Check if page is served over HTTPS or localhost
            const isSecure = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            if (!isSecure) {
                alert('Geolocation requires HTTPS or localhost. Please enter coordinates manually or serve the page over HTTPS.');
                button.textContent = originalText;
                button.disabled = false;
                return;
            }

            const options = {
                enableHighAccuracy: true,
                timeout: 10000, // 10 seconds
                maximumAge: 60000 // 1 minute
            };

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    console.log('Location success:', position);
                    document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                    document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                    button.textContent = '‚úÖ Location found!';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.disabled = false;
                    }, 2000);
                    console.log(`Location obtained: ${position.coords.latitude}, ${position.coords.longitude}`);
                },
                (error) => {
                    console.error('Geolocation error:', error);
                    let errorMessage = 'Could not get your location. ';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Permission denied. Please allow location access and try again.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Location request timed out.';
                            break;
                        default:
                            errorMessage += 'An unknown error occurred.';
                            break;
                    }
                    
                    errorMessage += '\n\nPlease enter coordinates manually or try again.';
                    alert(errorMessage);
                    
                    button.textContent = '‚ùå Location failed';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.disabled = false;
                    }, 3000);
                },
                options
            );
        }

        function showLocationHelp() {
            const helpMessage = `üìç How to get your coordinates:

Method 1: Google Maps
‚Ä¢ Open maps.google.com
‚Ä¢ Right-click on your location
‚Ä¢ Click the coordinates that appear
‚Ä¢ Copy them here

Method 2: GPS Coordinates app
‚Ä¢ Search "GPS coordinates" in your app store
‚Ä¢ Use any GPS app on your phone

Method 3: Manual entry
‚Ä¢ If you know your approximate address, search online for "[your address] coordinates"

The format should be:
Latitude: Like 40.7128 (North/South)
Longitude: Like -74.0060 (East/West)`;

            alert(helpMessage);
        }

        function loadMap() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);

            if (isNaN(lat) || isNaN(lng)) {
                alert('Please enter valid coordinates.');
                return;
            }

            // Validate coordinates are reasonable
            if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
                alert('Please enter valid coordinates (latitude: -90 to 90, longitude: -180 to 180).');
                return;
            }

            // Clear the map div and create a new map
            const mapDiv = document.getElementById('map');
            mapDiv.innerHTML = '';
            
            // Destroy existing map if it exists
            if (map !== null) {
                map.remove();
                map = null;
            }

            // Create new Leaflet map
            map = L.map('map').setView([lat, lng], 16);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Add a marker at the center location
            L.marker([lat, lng])
                .addTo(map)
                .bindPopup(`üìç Your Location<br>${lat.toFixed(4)}, ${lng.toFixed(4)}`)
                .openPopup();

            // Add a circle to show the radius
            const radius = parseInt(document.getElementById('radius').value);
            L.circle([lat, lng], {
                color: '#4f46e5',
                fillColor: '#4f46e5',
                fillOpacity: 0.1,
                radius: radius
            }).addTo(map).bindPopup(`Search radius: ${radius}m`);

            console.log(`Real map loaded for coordinates: ${lat}, ${lng} with ${radius}m radius`);
        }

        function generateGrid() {
            const gridSize = parseInt(document.getElementById('grid-size').value);
            const radius = parseInt(document.getElementById('radius').value);
            const gridOverlay = document.getElementById('grid-overlay');
            
            // Clear existing grid
            gridOverlay.innerHTML = '';
            gridCells = [];

            const cellSize = 100 / gridSize; // Percentage size of each cell

            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell unknown';
                    cell.style.left = `${col * cellSize}%`;
                    cell.style.top = `${row * cellSize}%`;
                    cell.style.width = `${cellSize}%`;
                    cell.style.height = `${cellSize}%`;
                    
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.dataset.state = 'unknown';
                    
                    // Add tooltip
                    cell.title = `Cell ${row},${col} - Click to classify`;
                    
                    cell.addEventListener('click', () => toggleCellState(cell));
                    
                    gridOverlay.appendChild(cell);
                    gridCells.push(cell);
                }
            }

            updateStats();
            console.log(`Generated ${gridSize}x${gridSize} grid (${gridCells.length} cells)`);
            
            // Show success message
            const originalText = event.target.textContent;
            event.target.textContent = `‚úÖ ${gridCells.length} cells created!`;
            setTimeout(() => {
                event.target.textContent = originalText;
            }, 2000);
        }

        function toggleCellState(cell) {
            const currentState = cell.dataset.state;
            let newState;
            
            // Cycle through states: unknown -> walkable -> non-walkable -> unknown
            switch (currentState) {
                case 'unknown':
                    newState = 'walkable';
                    break;
                case 'walkable':
                    newState = 'non-walkable';
                    break;
                case 'non-walkable':
                    newState = 'unknown';
                    break;
                default:
                    newState = 'unknown';
            }
            
            cell.dataset.state = newState;
            cell.className = `grid-cell ${newState}`;
            cell.title = `Cell ${cell.dataset.row},${cell.dataset.col} - ${newState.replace('-', ' ')}`;
            
            updateStats();

            // Visual feedback
            cell.style.transform = 'scale(1.1)';
            setTimeout(() => {
                cell.style.transform = '';
            }, 150);
        }

        function updateStats() {
            const walkable = gridCells.filter(cell => cell.dataset.state === 'walkable').length;
            const nonWalkable = gridCells.filter(cell => cell.dataset.state === 'non-walkable').length;
            const unknown = gridCells.filter(cell => cell.dataset.state === 'unknown').length;
            const total = gridCells.length;
            
            const classified = walkable + nonWalkable;
            const coveragePercent = total > 0 ? Math.round((classified / total) * 100) : 0;
            
            document.getElementById('walkable-count').textContent = walkable;
            document.getElementById('non-walkable-count').textContent = nonWalkable;
            document.getElementById('unknown-count').textContent = unknown;
            document.getElementById('coverage-percent').textContent = `${coveragePercent}%`;
        }

        function clearGrid() {
            if (gridCells.length === 0) {
                alert('No grid to clear. Generate a grid first!');
                return;
            }

            gridCells.forEach(cell => {
                cell.dataset.state = 'unknown';
                cell.className = 'grid-cell unknown';
                cell.title = `Cell ${cell.dataset.row},${cell.dataset.col} - Click to classify`;
            });
            updateStats();
            
            // Visual feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Grid cleared!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 1500);
        }

        // Keyboard shortcuts for easier testing
        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'c') {
                clearGrid();
                e.preventDefault();
            }
            if (e.key.toLowerCase() === 'g') {
                generateGrid();
                e.preventDefault();
            }
        });

        // Initialize with default coordinates
        document.getElementById('latitude').value = defaultCoords.lat;
        document.getElementById('longitude').value = defaultCoords.lng;

        // Welcome message
        console.log('üó∫Ô∏è Walkable Areas Grid Test loaded');
        console.log('');
        console.log('üìã Instructions:');
        console.log('1. Enter your coordinates or click "Use My Location"');
        console.log('2. Click "Load Map" to visualize your area');
        console.log('3. Click "Generate Grid" to create the test grid');
        console.log('4. Click grid cells to cycle through: Unknown ‚Üí Walkable ‚Üí Non-walkable');
        console.log('');
        console.log('‚å®Ô∏è Keyboard shortcuts: C=clear, G=generate');
        console.log('');
        console.log('This test simulates how your dog walking app would analyze walkable areas!');
    </script>
</body>
</html> 